#!/usr/bin/env bash

set -e

age_dir=.age
age_file=keys.txt
path_to_age=~/${age_dir}
path_to_age_file=${path_to_age}/${age_file}

if [ -f "$path_to_age_file" ]; then
  echo "Info: age key has already existed! Skip."
  exit
fi

echo "Pls enter username: "
read user
echo "Pls enter pw: "
read -s pw
echo "Pls enter host: "
read host

mkdir -p ${path_to_age}

curl -s -o ${path_to_age_file} -H "Authorization: Basic $(printf ${user}:${pw} | base64)" https://${host}/1:/Config/${age_dir}/${age_file}

echo "Restore age keys successfully! The key is in ${path_to_age_file}."
